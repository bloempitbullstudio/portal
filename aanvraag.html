<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roblox Game Aanvraag</title>
  <!-- Favicon & app icons -->
  <link rel="icon" type="image/png" href="favicon.png" sizes="256x256">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="theme-color" content="#0f0c29" />

  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --border:#1f2937;
      --accent:#22d3ee; --accent2:#8b5cf6; --danger:#ef4444;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 10% 0%, #0a0f1f, #030712 60%), var(--bg);
      color: var(--text); min-height:100vh; display:flex; flex-direction:column;
    }
    header{ border-bottom:1px solid var(--border); background:rgba(17,24,39,.7); backdrop-filter: blur(6px); }
    .container{ width:min(1100px, 92vw); margin:0 auto; padding:1rem 0; }
    .brand{ display:flex; align-items:center; gap:.75rem; }
    .logo{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; font-weight:900; background:conic-gradient(from 210deg, var(--accent), var(--accent2), var(--accent)); color:#0b1020; box-shadow:0 0 20px rgba(34,211,238,.35); }
    nav{ display:flex; align-items:center; gap:.75rem; }
    .spacer{ flex:1; }
    .btn{
      appearance:none; border:1px solid var(--border); color:var(--text);
      background: linear-gradient(180deg, #0d1324, #0a0f1f); padding:.55rem .8rem; border-radius:10px; cursor:pointer; transition:.15s;
      font-weight:600;
    }
    .btn:hover{ border-color:#2a3648; box-shadow:0 0 0 3px rgba(139,92,246,.12); transform: translateY(-1px); }
    .btn.small{ font-size:.9rem; padding:.45rem .6rem; }
    .btn.danger{ border-color:#7f1d1d; color:#fecaca; }
    .grid{ display:grid; gap:1.25rem; grid-template-columns:1fr; }
    @media (min-width: 960px){ .grid{ grid-template-columns: 360px 1fr; } }
    .card{ background: linear-gradient(180deg, #0a0f1f, #0b1220); border:1px solid var(--border); border-radius:16px; padding:1rem; box-shadow:0 8px 30px rgba(0,0,0,.25); }
    .muted{ color:var(--muted); }
    .field{ display:grid; gap:.35rem; margin-bottom:.7rem; }
    input,select,textarea{ width:100%; background:#0a1020; color:var(--text); border:1px solid #1b2434; border-radius:10px; padding:.6rem .7rem; outline:none; }
    input:focus,select:focus,textarea:focus{ border-color:#2a3a55; box-shadow:0 0 0 3px rgba(34,211,238,.12); }
    textarea{ min-height:120px; resize:vertical; }
    .status{ display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .5rem; border-radius:999px; font-size:.8rem; border:1px solid var(--border); }
    .status.pending{ color:#fde68a; border-color:#7c5d16; }
    .status.progress{ color:#a7f3d0; border-color:#1d6b56; }
    .status.accepted{ color:#bbf7d0; border-color:#1e6f3d; }
    .status.rejected{ color:#fecaca; border-color:#7f1d1d; }
    table{ width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px; border:1px solid var(--border); }
    th,td{ padding:.6rem .5rem; border-bottom:1px solid var(--border); text-align:left; vertical-align:top; }
    th{ color:var(--muted); font-weight:600; background:#0b1324; }
    tr:hover td{ background:#0b1120; }
    .empty{ border:1px dashed #233049; border-radius:12px; padding:.9rem; color:var(--muted); text-align:center; background: repeating-linear-gradient(45deg, #091126, #091126 10px, #0a152e 10px, #0a152e 20px); }
    footer{ color:var(--muted); font-size:.9rem; text-align:center; padding:14px 10px; }
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex; align-items:center; gap:1rem;">
      <div class="brand">
        <div class="logo">R</div>
        <div>
          <div style="font-weight:700">Roblox Game Aanvragen</div>
          <div class="muted" style="font-size:.9rem">Vraag games aan ‚Ä¢ Beheer verzoeken</div>
        </div>
      </div>
      <div class="spacer"></div>
      <nav>
        <span id="currentUserInfo" class="muted"></span>
        <button id="toIndexBtn" class="btn small">üè† Start</button>
        <button id="logoutBtn" class="btn small">Afmelden</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <div class="card">
        <h3>Nieuw verzoek indienen</h3>
        <p class="muted">Beschrijf jouw Roblox game‚Äëidee zo duidelijk mogelijk.</p>
        <div class="field">
          <label for="reqTitle">Titel *</label>
          <input id="reqTitle" type="text" placeholder="bijv. Obby Challenge Extreme" />
        </div>
        <div class="field">
          <label for="reqGenre">Genre *</label>
          <select id="reqGenre">
            <option value="">‚Äî kies een genre ‚Äî</option>
            <option>Obby</option><option>Simulator</option><option>Tycoon</option>
            <option>Adventure</option><option>Roleplay</option><option>FPS</option>
            <option>Horror</option><option>Racing</option><option>Anders</option>
          </select>
        </div>
        <div class="field">
          <label for="reqPriority">Prioriteit</label>
          <select id="reqPriority">
            <option>Normaal</option><option>Laag</option><option>Hoog</option>
          </select>
        </div>
        <div class="field">
          <label for="reqDesc">Beschrijving *</label>
          <textarea id="reqDesc" placeholder="Wat is het doel? Welke mechanics? Eventuele referenties?"></textarea>
        </div>
        <div class="field">
          <label for="reqAssets">Links naar assets (optioneel)</label>
          <input id="reqAssets" type="text" placeholder="Trello/GDrive, modellen, audio‚Ä¶" />
        </div>
        <div><button id="submitRequestBtn" class="btn">Verzoek indienen</button></div>
        <p class="muted" style="margin-top:.6rem;">Statussen: <span class="status pending">In afwachting</span> ‚Üí <span class="status progress">In behandeling</span> ‚Üí <span class="status accepted">Geaccepteerd</span> / <span class="status rejected">Geweigerd</span></p>
      </div>

      <div class="card">
        <h3 id="listTitle">Mijn verzoeken</h3>
        <div id="requestsList"></div>
      </div>
    </div>
  </main>

  <footer>
    <span id="footerText"></span>
  </footer>

  <script>
    // ---------- Helpers & storage ----------
    const $ = s => document.querySelector(s);
    const reqKey = 'requests';
    const currentUserKey = 'currentUser';

    function fmtDate(iso){ const d = new Date(iso); return d.toLocaleString(); }
    function getRequests(){ try { return JSON.parse(localStorage.getItem(reqKey) || '[]'); } catch { return []; } }
    function saveRequests(list){ localStorage.setItem(reqKey, JSON.stringify(list)); }
    function getCurrentUser(){ return localStorage.getItem(currentUserKey) || ''; }
    function setCurrentUser(u){ localStorage.setItem(currentUserKey, u || ''); }
    function isOwner(u){ return u && u.toLowerCase() === 'bloempitbull'; }
    function uid(){ return 'id_'+Date.now().toString(36)+Math.random().toString(36).slice(2,8); }
    function escapeHtml(str){
      return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#039;');
    }
    function linkify(text){
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      return text.replace(urlRegex, url => `<a href="${url}" target="_blank" rel="noopener">${url}</a>`);
    }

    // ---------- Auth check ----------
    function requireLogin(){
      const u = getCurrentUser();
      if(!u){
        alert('Log eerst in op de startpagina.');
        window.location.href = 'index.html';
        return false;
      }
      return true;
    }

    // ---------- Requests ----------
    function collectForm(){
      return {
        title: document.getElementById('reqTitle').value.trim(),
        genre: document.getElementById('reqGenre').value,
        priority: document.getElementById('reqPriority').value,
        description: document.getElementById('reqDesc').value.trim(),
        assets: document.getElementById('reqAssets').value.trim(),
      };
    }
    function clearForm(){
      document.getElementById('reqTitle').value=''; document.getElementById('reqGenre').value='';
      document.getElementById('reqPriority').value='Normaal'; document.getElementById('reqDesc').value=''; document.getElementById('reqAssets').value='';
    }
    function validate(data){
      const e = [];
      if(!data.title) e.push('Titel is verplicht.');
      if(!data.genre) e.push('Genre is verplicht.');
      if(!data.description) e.push('Beschrijving is verplicht.');
      return e;
    }
    function submitRequest(){
      const u = getCurrentUser();
      if(!u) return;
      const data = collectForm();
      const errs = validate(data);
      if(errs.length){ alert(errs.join('
')); return; }
      const list = getRequests();
      list.push({
        id: uid(),
        user: u,
        title: data.title,
        genre: data.genre,
        priority: data.priority,
        description: data.description,
        assets: data.assets,
        status: 'pending',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      });
      saveRequests(list);
      clearForm();
      render();
      alert('Verzoek ingediend!');
    }
    function changeStatus(id, status){
      const u = getCurrentUser();
      if(!isOwner(u)){ alert('Alleen owner kan statussen wijzigen.'); return; }
      const list = getRequests();
      const i = list.findIndex(x => x.id === id);
      if(i>=0){
        list[i].status = status;
        list[i].updatedAt = new Date().toISOString();
        saveRequests(list);
        render();
      }
    }

    function statusPill(s){
      const map = { pending:['pending','In afwachting'], progress:['progress','In behandeling'], accepted:['accepted','Geaccepteerd'], rejected:['rejected','Geweigerd'] };
      const [cls,txt] = map[s] || map.pending;
      return `<span class="status ${cls}">${txt}</span>`;
    }

    function render(){
      const u = getCurrentUser();
      const owner = isOwner(u);
      document.getElementById('currentUserInfo').textContent = u ? `Ingelogd als ${u}${owner?' (owner)':''}` : '';
      const list = getRequests().sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      const mine = owner ? list : list.filter(x => x.user === u);
      document.getElementById('listTitle').textContent = owner ? 'Alle verzoeken (owner)' : 'Mijn verzoeken';

      const holder = document.getElementById('requestsList'); holder.innerHTML = '';
      if(mine.length === 0){
        holder.innerHTML = `<div class="empty">Nog geen verzoeken ${owner ? 'van gebruikers' : 'van jou'}.</div>`;
        return;
      }
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>Titel</th>
            <th>Info</th>
            <th>Status</th>
            <th>Aangemaakt</th>
            ${owner ? '<th>Acties</th>' : ''}
          </tr>
        </thead>
        <tbody>
          ${mine.map(r=>`
            <tr>
              <td>
                <div style="font-weight:600;">${escapeHtml(r.title)}</div>
                <div class="muted" style="font-size:.9rem;">${escapeHtml(r.genre)} ‚Ä¢ Prioriteit: ${escapeHtml(r.priority)}</div>
                ${r.assets ? `<div class="muted" style="font-size:.85rem;">Assets: ${linkify(escapeHtml(r.assets))}</div>` : ''}
              </td>
              <td style="max-width:520px;">
                <div style="white-space:pre-wrap;">${escapeHtml(r.description)}</div>
                ${owner ? `<div class="muted" style="margin-top:.3rem;">Ingediend door: ${escapeHtml(r.user)}</div>` : ''}
              </td>
              <td>${statusPill(r.status)}</td>
              <td>
                <div>${fmtDate(r.createdAt)}</div>
                ${r.updatedAt && r.updatedAt !== r.createdAt ? `<div class="muted" style="font-size:.85rem;">Ge√ºpdatet: ${fmtDate(r.updatedAt)}</div>` : ''}
              </td>
              ${owner ? `
                <td style="min-width: 230px;">
                  <div style="display:flex; flex-wrap:wrap; gap:.35rem;">
                    <button class="btn small" onclick="changeStatus('${r.id}','pending')">In afwachting</button>
                    <button class="btn small" onclick="changeStatus('${r.id}','progress')">In behandeling</button>
                    <button class="btn small" onclick="changeStatus('${r.id}','accepted')">Geaccepteerd</button>
                    <button class="btn small danger" onclick="changeStatus('${r.id}','rejected')">Weigeren</button>
                  </div>
                </td>
              ` : ''}
            </tr>
          `).join('')}
        </tbody>`;
      holder.appendChild(table);

      // Dynamische footer
      const start = 2025; const y = new Date().getFullYear();
      const yr = y>start ? `${start}-${y}` : `${start}`;
      document.getElementById('footerText').textContent = `All rights reserved  Bloempitbull Studio ${yr} ¬© - Made by Bloempitbull :)`;
    }

    // ---------- Wireup ----------
    document.getElementById('submitRequestBtn').addEventListener('click', submitRequest);
    document.getElementById('logoutBtn').addEventListener('click', ()=>{ setCurrentUser(''); window.location.href='index.html'; });
    document.getElementById('toIndexBtn').addEventListener('click', ()=>{ window.location.href='index.html'; });

    // Init
    (function(){
      if(!requireLogin()) return;
      render();
    })();
  </script>
</body>
</html>
